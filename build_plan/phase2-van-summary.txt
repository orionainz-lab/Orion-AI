â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  PHASE 2 VAN ANALYSIS: THE RELIABLE BRAIN                â•‘
â•‘                       Solving the Syntax Gap                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ MISSION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   Build AI agents that generate SYNTACTICALLY VALID CODE on first try
   
   Problem: AI models produce syntax errors 15-30% of the time
   Solution: LangGraph cyclic reasoning + Python AST verification
   Target: 95%+ first-attempt success rate

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ—ï¸ ARCHITECTURE (High-Level)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  LangGraph Cyclic Reasoning Loop                     â”‚
   â”‚  (runs as Temporal Workflow - inherits durability)   â”‚
   â”‚                                                        â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚  â”‚ Plan â”‚â”€â–¶â”‚ Generate â”‚â”€â–¶â”‚ Verify   â”‚â”€â–¶â”‚ Correct  â”‚â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚     â”‚           â–²            â”‚ (AST)         â”‚       â”‚
   â”‚     â”‚           â”‚            â”œâ”€ Valid? â”€â”€â–¶ END      â”‚
   â”‚     â”‚           â”‚            â””â”€ Invalid? â”€â”€â”€â”˜       â”‚
   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ COMPONENTS (6 Total)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   1. State Schema (agents/state.py, ~80 lines)
      â”œâ”€ TypedDict for LangGraph state
      â”œâ”€ Fields: task, plan, code, errors, iteration
      â””â”€ Type-safe, observable

   2. Reasoning Nodes (agents/reasoning_nodes.py, ~180 lines)
      â”œâ”€ plan_node: Analyze task (LLM)
      â”œâ”€ generate_node: Generate code (LLM)
      â”œâ”€ verify_node: AST parse (Activity)
      â”œâ”€ correct_node: Generate feedback (Rule-based/LLM)
      â””â”€ Conditional edge: valid â†’ END, invalid â†’ correct

   3. AST Verifier (verification/ast_verifier.py, ~150 lines)
      â”œâ”€ verify_python_syntax: ast.parse() wrapper
      â”œâ”€ validate_imports: Check stdlib/installed
      â”œâ”€ extract_error_details: Structure errors
      â””â”€ All Temporal activities (idempotent)

   4. LangGraph Workflow (agents/code_generation_workflow.py, ~180 lines)
      â”œâ”€ Temporal @workflow.defn
      â”œâ”€ Builds LangGraph graph
      â”œâ”€ Executes reasoning loop
      â””â”€ Returns valid code or errors

   5. LLM Clients (agents/llm_clients.py, ~120 lines)
      â”œâ”€ Claude Sonnet 4.5 client
      â”œâ”€ Gemini 2.0 Flash client (optional)
      â”œâ”€ Token counting
      â””â”€ Rate limit handling

   6. Config Extension (agents/config.py, ~60 lines)
      â”œâ”€ LangGraphConfig dataclass
      â”œâ”€ LLMConfig dataclass
      â””â”€ Reuses Phase 1 pattern

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”§ TECHNOLOGY STACK
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   NEW (Phase 2):
   â”œâ”€ langgraph (>= 0.2.0)          - Cyclic reasoning framework
   â”œâ”€ langchain-core (>= 0.3.0)     - LangGraph dependency
   â”œâ”€ langchain-anthropic           - Claude integration
   â”œâ”€ langchain-google-genai        - Gemini integration
   â”œâ”€ Python ast (built-in)         - Syntax verification
   â”œâ”€ black (>= 24.0)               - Code formatting validation
   â””â”€ isort (>= 5.13)               - Import validation

   INHERITED (Phase 1):
   â”œâ”€ Temporal.io                   - Workflow engine âœ…
   â”œâ”€ Docker Compose                - Service orchestration âœ…
   â”œâ”€ pytest                        - Testing framework âœ…
   â””â”€ psutil                        - Process management âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ REQUIREMENTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   Functional:
   âœ“ FR-P2-001: LangGraph cyclic reasoning (4 nodes, conditional edges)
   âœ“ FR-P2-002: Python AST verification (syntax errors)
   âœ“ FR-P2-003: Import validation (stdlib + installed)
   âœ“ FR-P2-004: Error-to-feedback translation
   âœ“ FR-P2-005: Temporal integration (workflow + activities)
   âœ“ FR-P2-006: Chaos testing (reasoning loop recovery)

   Non-Functional:
   âœ“ NFR-P2-001: Performance (<30s per loop, <100ms AST)
   âœ“ NFR-P2-002: Code quality (200-line rule, type hints)
   âœ“ NFR-P2-003: Observability (logs, Temporal UI)
   âœ“ NFR-P2-004: Extensibility (pluggable verifiers)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ RISKS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   HIGH PRIORITY:
   âš ï¸ R-P2-001: LangGraph learning curve
      Mitigation: VAN QA hello-world before PLAN
   
   âš ï¸ R-P2-004: Infinite reasoning loops
      Mitigation: Hard limit of 3 iterations
   
   âš ï¸ R-P2-005: LangGraph-Temporal integration
      Mitigation: VAN QA proof-of-concept

   MEDIUM PRIORITY:
   âš ï¸ R-P2-002: AST parser edge cases
      Mitigation: Comprehensive test suite (100+ samples)
   
   âš ï¸ R-P2-003: LLM API rate limits
      Mitigation: Exponential backoff, token budgeting

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… ACCEPTANCE CRITERIA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   MUST HAVE:
   â˜ LangGraph graph (4 nodes: plan, generate, verify, correct)
   â˜ Conditional edge routing (valid â†’ END, invalid â†’ loop)
   â˜ Python AST verification activity
   â˜ Integration with Temporal (workflow + activities)
   â˜ Simple test: Generate "Hello World" function (3 iterations max)
   â˜ Chaos test: Kill during verification â†’ Loop resumes
   â˜ All files â‰¤ 200 lines
   â˜ 95%+ first-attempt success rate (20-task test suite)

   SHOULD HAVE:
   â˜ Import validation
   â˜ Error-to-feedback translation
   â˜ Multi-LLM support (Claude + Gemini)
   â˜ Token usage tracking
   â˜ Comprehensive test suite (20+ tasks)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â±ï¸ TIME ESTIMATE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   Based on Phase 1 learnings:
   
   Sub-Phase 2.1: LangGraph Hello World       2-3h (High confidence)
   Sub-Phase 2.2: AST Verification            2-3h (High confidence)
   Sub-Phase 2.3: LangGraph-Temporal          2-3h (Medium confidence)
   Sub-Phase 2.4: Cyclic Reasoning            2-3h (Medium confidence)
   Sub-Phase 2.5: LLM Integration             1-2h (High confidence)
   Sub-Phase 2.6: Chaos Testing               1-2h (High confidence)
   
   TOTAL: 8-12 hours (vs 12-18h naive estimate)
   
   Expected Savings: 50-60% (based on Phase 1 ROI of 72%)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”„ PHASE 1 LESSONS APPLIED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   1. âœ… Always run VAN QA before BUILD
      Application: Test LangGraph + AST + Temporal BEFORE planning
   
   2. âœ… Plan for utils/ extraction at 150 lines
      Application: Create utils/ast_utils.py, utils/langgraph_utils.py
   
   3. âœ… Chaos testing framework is reusable
      Application: Use utils/chaos_utils.py for reasoning loop tests
   
   4. âœ… Integration tests beat unit tests
      Application: Focus on end-to-end LangGraph + Temporal tests
   
   5. âœ… Docker first, code second
      Application: Add Redis to docker-compose.yml in VAN QA if needed

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” PENDING DECISIONS (For PLAN Mode)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   ADR-007: LangGraph Integration Pattern
   â”œâ”€ Option 1: LangGraph AS Temporal Workflow (Recommended)
   â”œâ”€ Option 2: LangGraph OUTSIDE Temporal
   â””â”€ Decision: Pending PLAN mode

   ADR-008: LLM Provider Strategy
   â”œâ”€ Option 1: Claude Sonnet 4.5 only
   â”œâ”€ Option 2: Multi-LLM (Claude + 
